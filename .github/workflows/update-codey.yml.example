# .github/workflows/update-codey.yml
name: 🐾 Update Codey Tamagotchi

on:
  schedule:
    # Täglich um 6:00 UTC (8:00 MESZ)
    - cron: '0 6 * * *'
  workflow_dispatch: # Manuelle Ausführung möglich
  push:
    branches: [ main ]
    paths: 
      - '.github/workflows/update-codey.yml'
      - 'scripts/**'

jobs:
  update-codey:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read

    steps:
    - name: 🚀 Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: 📦 Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests python-dateutil

    - name: 📊 Fetch GitHub Stats
      id: github-stats
      run: |
        python scripts/fetch_github_stats.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        REPO_OWNER: ${{ github.repository_owner }}
        REPO_NAME: ${{ github.event.repository.name }}

    - name: 🎨 Generate Codey SVG
      id: generate-svg
      run: |
        python scripts/generate_codey.py
      env:
        GITHUB_STATS: ${{ steps.github-stats.outputs.stats }}

    - name: 📝 Update README
      run: |
        python scripts/update_readme.py

    - name: 💾 Commit Changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Codey Bot 🤖"
        
        if [[ `git status --porcelain` ]]; then
          git add codey.svg README.md codey-data.json
          git commit -m "🐾 Daily Codey update - $(date +'%Y-%m-%d %H:%M')"
          git push
        else
          echo "No changes to commit"
        fi

    - name: 📈 Update Stats Badge
      uses: schneegans/dynamic-badges-action@v1.6.0
      with:
        auth: ${{ secrets.GIST_SECRET }}
        gistID: ${{ secrets.GIST_ID }}
        filename: codey-stats.json
        label: Codey Health
        message: ${{ steps.generate-svg.outputs.health }}%
        color: ${{ steps.generate-svg.outputs.health_color }}

---

# .github/workflows/codey-emergency.yml
name: 🚨 Codey Emergency Care

on:
  schedule:
    # Alle 6 Stunden prüfen ob Codey Hilfe braucht
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  emergency-check:
    runs-on: ubuntu-latest
    if: github.repository_owner == github.actor || github.event_name == 'workflow_dispatch'

    steps:
    - name: 🚀 Checkout
      uses: actions/checkout@v4

    - name: 🐍 Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: 🔍 Check Codey Health
      run: |
        python scripts/emergency_check.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: 📧 Send Emergency Notification
      if: env.CODEY_CRITICAL == 'true'
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: "🚨 Codey braucht deine Hilfe!"
        to: ${{ secrets.NOTIFICATION_EMAIL }}
        from: Codey Bot <noreply@github.com>
        html_body: |
          <h2>🐾 Codey Emergency Alert!</h2>
          <p>Dein virtuelles Haustier Codey braucht dringend deine Aufmerksamkeit!</p>
          
          <h3>📊 Aktueller Status:</h3>
          <ul>
            <li>Gesundheit: ${{ env.CODEY_HEALTH }}% ❤️</li>
            <li>Hunger: ${{ env.CODEY_HUNGER }}% 🍖</li>
            <li>Glück: ${{ env.CODEY_HAPPINESS }}% 😊</li>
            <li>Energie: ${{ env.CODEY_ENERGY }}% ⚡</li>
          </ul>
          
          <p><strong>Letzte Aktivität:</strong> vor ${{ env.DAYS_INACTIVE }} Tagen</p>
          
          <h3>💡 Empfehlungen:</h3>
          <ul>
            <li>Mache ein paar Commits 📝</li>
            <li>Merge einen Pull Request 🔄</li>
            <li>Schließe ein Issue ✅</li>
          </ul>
          
          <p>Besuche dein <a href="https://github.com/${{ github.repository_owner }}">GitHub Profil</a> um Codey zu sehen!</p>

---

# .github/workflows/codey-achievements.yml
name: 🏆 Codey Achievements

on:
  push:
    branches: [ main ]
  pull_request:
    types: [ closed ]
  issues:
    types: [ closed ]
  watch:
    types: [ started ]

jobs:
  check-achievements:
    runs-on: ubuntu-latest
    if: github.event_name != 'pull_request' || github.event.pull_request.merged == true

    steps:
    - name: 🚀 Checkout
      uses: actions/checkout@v4

    - name: 🐍 Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: 🏆 Check for New Achievements
      run: |
        python scripts/check_achievements.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        EVENT_TYPE: ${{ github.event_name }}
        REPO_OWNER: ${{ github.repository_owner }}

    - name: 🎉 Celebrate Achievement
      if: env.NEW_ACHIEVEMENT == 'true'
      run: |
        echo "🎉 Neues Achievement freigeschaltet: ${{ env.ACHIEVEMENT_NAME }}"
        python scripts/generate_achievement_svg.py
      env:
        ACHIEVEMENT: ${{ env.ACHIEVEMENT_NAME }}

    - name: 📱 Post Achievement to Discussion
      if: env.NEW_ACHIEVEMENT == 'true'
      uses: actions/github-script@v7
      with:
        script: |
          const achievement = process.env.ACHIEVEMENT_NAME;
          const body = `🎉 **Neues Codey Achievement freigeschaltet!**
          
          ### 🏆 ${achievement}
          
          ![Achievement](https://github.com/${{ github.repository }}/blob/main/achievements/${achievement.toLowerCase().replace(/ /g, '-')}.svg)
          
          Codey ist stolz auf deine Leistung! 🐾`;
          
          // Erstelle einen neuen Discussion Post (falls Discussions aktiviert)
          try {
            await github.rest.repos.createDiscussion({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `🏆 Achievement: ${achievement}`,
              body: body,
              category_slug: 'announcements'
            });
          } catch (error) {
            console.log('Discussions not available, skipping...');
          }

---

# Zusätzlich: .github/dependabot.yml
version: 2
updates:
  # GitHub Actions Updates
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
    commit-message:
      prefix: "🤖 "
      include: "scope"

  # Python Dependencies Updates
  - package-ecosystem: "pip"
    directory: "/scripts"
    schedule:
      interval: "weekly"
    commit-message:
      prefix: "🐍 "
